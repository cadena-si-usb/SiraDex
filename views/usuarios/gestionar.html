{{ extend 'layoutSIRADEXloged.html' }}

{{block titulo}}
    Gestión de Usuarios
{{end}}

{{block descripcion}}
    <div id = "error">
        {{=message}}
    </div>
{{end}}

{{block contenido}}
    <div class="row">
    <div class="col-md-12">
        <div class="card">
                <!-- Nav tabs -->
        <ul class="nav nav-tabs" role="tablist">
        <li role="presentation" class="active">
            <a  href="#admin"
                aria-controls="admin"
                role="tab"
                data-toggle="tab">
                Administrador
            </a>
        </li>

        <li role="presentation">
            <a  href="#user"
                aria-controls="user"
                role="tab"
                data-toggle="tab">
                Usuario
            </a>
        </li>

        <li role="presentation">
            <a  href="#dex"
                aria-controls="dex"
                role="tab"
                data-toggle="tab">
                DEX
            </a>
        </li>

        <li role="presentation" class='rec'>
            <a  href="#bloq"
                aria-controls="bloq"
                role="tab"
                data-toggle="tab">
                Bloqueado
            </a>
        </li>

        <li role="presentation" class='rec'>
            <a  href="#indef"
                aria-controls="indef"
                role="tab"
                data-toggle="tab">
                Indefinido
            </a>
        </li>
        </ul>

        <!-- Tab panes -->
        <div class="tab-content">
        <!-- Administradores -->
        <div role="tabpanel" class="tab-pane active" id="admin">
            <table class="table table-striped table-condensed table-hover sortable">
                <thead>
                    <tr>
                    <th>Usbid</th>
                    <th>Nombres</th>
                    <th>Apellidos</th>
                    <th><center>Contactar</center></th>
                    <th><center>Modificar</center></th>
                    <th><center>Eliminar</center></th>
                    </tr>
                </thead>
                <tbody>
                {{for usuario in usuarios:}}
                    {{if usuario.tipo == 'Administrador':}}
                    <tr>
                    <td class="center-vertically">{{ =usuario.usbid}}</td>
                    <td class="center-vertically">{{ =usuario.nombres}}</td>
                    <td class="center-vertically">{{ =usuario.apellidos}}</td>

                    <!-- Boton Contactar -->
                    <td class="center-vertically">
                    <center>

                    <button type="button" data-toggle="modal"
                                          data-target="#modalContactarUsuario"
                                          data-id-usuario="{{=usuario.usbid}}"
                                          class="glyphicon glyphicon-envelope green-icn"
                                          aria-hidden="true" style="border:none;background:none;color:#337ab7;">
                      <!-- <span  aria-hidden="true"></span> -->
                    </button>


                    </center>
                    </td>

                    <!-- Boton Modificar -->
                    <td class="center-vertically">
                    <center>
                    <a href="{{=URL(c='usuarios',f='modificar', args=[ usuario.usbid ] )}}">
                    <span class="glyphicon glyphicon-edit green-icn"></span>
                    </a>
                    </center>
                    </td>
                    <!-- Boton Eliminar -->
                    <td class="center-vertically">
                        <center>
                            <a>
                               <span class="glyphicon glyphicon-remove red" data-toggle="modal" data-target="#modalEliminarUsuario"
                                      data-link-eliminar="{{=URL(c='usuarios',f='eliminar', args=[usuario.usbid])}}"></span>
                            </a>
                        <center>
                    </td>
                    </tr>
                    {{pass}}
                {{pass}}
                </tbody>
            </table>
        </div>
        <!-- Usuarios -->
        <div role="tabpanel" class="tab-pane" id="user">
            <table class="table table-striped table-condensed table-hover sortable">
                <thead>
                    <tr>
                    <th>Usbid</th>
                    <th>Nombres</th>
                    <th>Apellidos</th>
                    <th><center>Contactar</center></th>
                    <th><center>Modificar</center></th>
                    <th><center>Eliminar</center></th>
                    </tr>
                </thead>
                <tbody>
                {{for usuario in usuarios:}}
                    {{if usuario.tipo == 'Usuario':}}
                    <tr>
                    <td class="center-vertically">{{ =usuario.usbid}}</td>
                    <td class="center-vertically">{{ =usuario.nombres}}</td>
                    <td class="center-vertically">{{ =usuario.apellidos}}</td>

                    <!-- Boton Contactar -->
                    <td class="center-vertically">
                    <center>

                    <button type="button" data-toggle="modal"
                                          data-target="#modalContactarUsuario"
                                          data-id-usuario="{{=usuario.usbid}}"
                                          class="glyphicon glyphicon-envelope green-icn"
                                          aria-hidden="true" style="border:none;background:none;color:#337ab7;">
                      <!-- <span  aria-hidden="true"></span> -->
                    </button>


                    </center>
                    </td>
                    <!-- Boton Modificar -->
                    <td class="center-vertically">
                    <center>
                    <a href="{{=URL(c='usuarios',f='modificar', args=[ usuario.usbid ] )}}">
                    <span class="glyphicon glyphicon-edit green-icn"></span>
                    </a>
                    </center>
                    </td>
                    <!-- Boton Eliminar -->
                    <td class="center-vertically">
                        <center>
                            <a>
                               <span class="glyphicon glyphicon-remove red" data-toggle="modal" data-target="#modalEliminarUsuario"
                                      data-link-eliminar="{{=URL(c='usuarios',f='eliminar', args=[usuario.usbid])}}"></span>
                            </a>
                        <center>
                    </td>
                    </tr>
                    {{pass}}
                {{pass}}
                </tbody>
            </table>
        </div>
        <!--  DEX -->
        <div role="tabpanel" class="tab-pane" id="dex">
            <table class="table table-striped table-condensed table-hover sortable">
                <thead>
                    <tr>
                    <th>Usbid</th>
                    <th>Nombres</th>
                    <th>Apellidos</th>
                    <th><center>Contactar</center></th>
                    <th><center>Modificar</center></th>
                    <th><center>Eliminar</center></th>
                    </tr>
                </thead>
                <tbody>
                {{for usuario in usuarios:}}
                    {{if usuario.tipo == 'DEX':}}
                    <tr>
                    <td class="center-vertically">{{ =usuario.usbid}}</td>
                    <td class="center-vertically">{{ =usuario.nombres}}</td>
                    <td class="center-vertically">{{ =usuario.apellidos}}</td>

                    <!-- Boton Contactar -->
                    <td class="center-vertically">
                    <center>

                    <button type="button" data-toggle="modal"
                                          data-target="#modalContactarUsuario"
                                          data-id-usuario="{{=usuario.usbid}}"
                                          class="glyphicon glyphicon-envelope green-icn"
                                          aria-hidden="true" style="border:none;background:none;color:#337ab7;">
                      <!-- <span  aria-hidden="true"></span> -->
                    </button>
                    </center>
                    </td>

                    <!-- Boton Modificar -->
                    <td class="center-vertically">
                    <center>
                    <a href="{{=URL(c='usuarios',f='modificar', args=[ usuario.usbid ] )}}">
                    <span class="glyphicon glyphicon-edit green-icn"></span>
                    </a>
                    </center>
                    </td>

                    <td class="center-vertically">
                        <center>
                            <a>
                               <span class="glyphicon glyphicon-remove red" data-toggle="modal" data-target="#modalEliminarUsuario"
                                      data-link-eliminar="{{=URL(c='usuarios',f='eliminar', args=[usuario.usbid])}}"></span>
                            </a>
                        <center>
                    </td>
                    </tr>
                    {{pass}}
                {{pass}}
                </tbody>
            </table>
        </div>
        <!-- Bloqueados -->
        <div role="tabpanel" class="tab-pane" id="bloq">
            <table class="table table-striped table-condensed table-hover sortable">
                <thead>
                    <tr>
                    <th>Usbid</th>
                    <th>Nombres</th>
                    <th>Apellidos</th>
                    <th><center>Contactar</center></th>
                    <th><center>Modificar</center></th>
                    <th><center>Eliminar</center></th>
                    </tr>
                </thead>
                <tbody>
                {{for usuario in usuarios:}}
                    {{if usuario.tipo == 'Bloqueado':}}
                    <tr>
                    <td class="center-vertically">{{ =usuario.usbid}}</td>
                    <td class="center-vertically">{{ =usuario.nombres}}</td>
                    <td class="center-vertically">{{ =usuario.apellidos}}</td>
                    <!-- Boton Contactar -->
                    <td class="center-vertically">
                    <center>

                    <button type="button" data-toggle="modal"
                                          data-target="#modalContactarUsuario"
                                          data-id-usuario="{{=usuario.usbid}}"
                                          class="glyphicon glyphicon-envelope green-icn"
                                          aria-hidden="true" style="border:none;background:none;color:#337ab7;">
                      <!-- <span  aria-hidden="true"></span> -->
                    </button>


                    </center>
                    </td>
                    <!-- Boton Modificar -->
                    <td class="center-vertically">
                    <center>
                    <a href="{{=URL(c='usuarios',f='modificar', args=[ usuario.usbid ] )}}">
                    <span class="glyphicon glyphicon-edit green-icn"></span>
                    </a>
                    </center>
                    </td>

                    <td class="center-vertically">
                        <center>
                            <a>
                               <span class="glyphicon glyphicon-remove red" data-toggle="modal" data-target="#modalEliminarUsuario"
                                      data-link-eliminar="{{=URL(c='usuarios',f='eliminar', args=[usuario.usbid])}}"></span>
                            </a>
                        <center>
                    </td>
                    </tr>
                    {{pass}}
                {{pass}}
                </tbody>
            </table>
        </div>
        <!-- Indefinido -->
        <div role="tabpanel" class="tab-pane" id="indef">
            <table class="table table-striped table-condensed table-hover sortable">
                <thead>
                    <tr>
                    <th>Usbid</th>
                    <th>Nombres</th>
                    <th>Apellidos</th>
                    <th><center>Contactar</center></th>
                    <th><center>Modificar</center></th>
                    <th><center>Eliminar</center></th>
                    </tr>
                </thead>
                <tbody>
                {{for usuario in usuarios:}}
                    {{if usuario.tipo not in ['Bloqueado','Administrador','Usuario','DEX']:}}
                    <tr>
                    <td class="center-vertically">{{ =usuario.usbid}}</td>
                    <td class="center-vertically">{{ =usuario.nombres}}</td>
                    <td class="center-vertically">{{ =usuario.apellidos}}</td>
                    <!-- Boton Contactar -->
                    <td class="center-vertically">
                    <center>

                    <button type="button" data-toggle="modal"
                                          data-target="#modalContactarUsuario"
                                          data-id-usuario="{{=usuario.usbid}}"
                                          class="glyphicon glyphicon-envelope green-icn"
                                          aria-hidden="true" style="border:none;background:none;color:#337ab7;">
                      <!-- <span  aria-hidden="true"></span> -->
                    </button>


                    </center>
                    </td>
                    <!-- Boton Modificar -->
                    <td class="center-vertically">
                    <center>
                    <a href="{{=URL(c='usuarios',f='modificar', args=[ usuario.usbid ] )}}">
                    <span class="glyphicon glyphicon-edit green-icn"></span>
                    </a>
                    </center>
                    </td>

                    <td class="center-vertically">
                        <center>
                            <a>
                               <span class="glyphicon glyphicon-remove red" data-toggle="modal" data-target="#modalEliminarUsuario"
                                      data-link-eliminar="{{=URL(c='usuarios',f='eliminar', args=[usuario.usbid])}}"></span>
                            </a>
                        <center>
                    </td>
                    </tr>
                    {{pass}}
                {{pass}}
                </tbody>
            </table>
        </div>
        </div>
    </div>
    <a href ="{{=URL(c='usuarios',f ='agregar')}}" id="sombra">
    {{=IMG(_src=URL('static', 'icon/i_add.png'),_height='55',_alt='Agregar Producto') }}
    </a>

<!-- Modal Eliminar-->
  <div id="modalEliminarUsuario" class="modal fade" role="dialog">
    <div class="modal-dialog">

    <!-- Contenido Modal -->
      <div class="modal-content">
        <div class="modal-header">
          <button type="button" class="close" data-dismiss="modal">&times;</button>
            <center> <h4 class="modal-title">Eliminar Usuario</h4> </center>
        </div>
        <div class="modal-body">
            <center> <p>Está seguro que quiere eliminar este usuario.</p> </center>
            <br>
            <center>
                <a id="BotonEliminar">
                  <button type="button" class="btn blue-add btn-border">
                          Eliminar
                  </button>
                </a>
                <button type="button" class="btn btn-default btn-border" data-dismiss="modal">Cerrar</button>
            </center>
          </div>
        </div>
      </div>
    </div>

<!-- Modal Modificar -->
  <div id="modalModificarUsuario" class="modal fade" role="dialog">
    <div class="modal-dialog">

    <!-- Contenido Modal -->
      <div class="modal-content">
        <div class="modal-header">
          <button type="button" class="close" data-dismiss="modal">&times;</button>
            <center> <h4 class="modal-title">Modificar Usuario</h4> </center>
        </div>
        <div class="modal-body">
            <center> <p>{{=form_editar}}</p> </center>
            <br>
            <center>
                <a id="BotonModificar">
                  <button type="button" class="btn blue-add btn-border">
                          Modificar
                  </button>
                </a>
                <button type="button" class="btn btn-default btn-border" data-dismiss="modal">Cerrar</button>
            </center>
          </div>
        </div>
      </div>
    </div>

    <!-- Modal Contactar-->
    <div id="modalContactarUsuario" class="modal fade" role="dialog" data-hayErrores="{{=hayErrores}}">
      <div class="modal-dialog">

        <!-- Modal content-->
        <div class="modal-content">
          <div class="modal-header">
            <button type="button" class="close" data-dismiss="modal">&times;</button>
            <center><h4 class="modal-title">Contactar Usuario</h4><center>
          </div>
          <div class="modal-body">
              <center>
                  <p>  {{=formulario_contactar}}</p>
              </center>
          </div>
        </div>
      </div>
    </div>
{{end}}

{{block script}}
    <script src="{{=URL('static','js/usuarios.js')}}"></script>

    <script>

      var hayErrores = $("#modalContactarUsuario").attr("data-hayErrores");
      hayErrores = hayErrores.replace(/<Storage |>/gi, "").replace(/'/g, '"')

      if (hayErrores != '{}') {
        $('#modalContactarUsuario').modal('show');
      }

      // Pasamos los argumentos para contactar el usuario
      $('#modalContactarUsuario').on('show.bs.modal', function(e){
          var usbid = $(e.relatedTarget).data('id-usuario');
          console.log(usbid);
          $(e.currentTarget).find('input[name="usbid"]').val(usbid);
          // Se quiere ocultar el usbid en el modalContactarUsuario
          $("#no_table_usbid__row").hide();
      });



    </script>
{{end}}
